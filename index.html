<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Professional App Hub</title>
    <!-- React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- html2canvas for Image Generation -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f1f5f9;
        }

        /* Ticker Animation */
        .ticker-container {
            overflow: hidden;
            white-space: nowrap;
        }
        .ticker-content {
            display: inline-block;
            padding-left: 100%;
            animation: ticker 25s linear infinite;
        }
        @keyframes ticker {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-100%, 0); }
        }

        /* Simple Spinner */
        .loader {
            border-top-color: #3b82f6;
            animation: spinner 0.8s linear infinite;
        }
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Animations */
        .fade-in { animation: fadeIn 0.2s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .modal-enter { animation: modalEnter 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes modalEnter {
            from { opacity: 0; transform: scale(0.9) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        /* Coffee Float Animation */
        .coffee-float { animation: float 3s ease-in-out infinite; }
        @keyframes float { 
            0%, 100% { transform: translateY(0px); } 
            50% { transform: translateY(-6px); } 
        }
    </style>
</head>
<body class="text-slate-900 h-screen w-screen overflow-hidden">
    <div id="root" class="h-full w-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- CONFIGURATION ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwX-IYZ0Kwwg6abtD--dfHslPEfNnlLvWkYJZRNOjHg65xndMaINSiq-8gumgheK9SPoA/exec"; 
        const UPI_ID = "dearhappy@sbi";
        const PAYEE_NAME = "Gurwinder Singh";

        // --- COMPONENTS ---

        const Ticker = ({ supporters }) => {
            if (!supporters || supporters.length === 0) return null;
            return (
                <div className="bg-slate-900 py-2.5 ticker-container shadow-md z-30 relative">
                    <div className="ticker-content">
                        {supporters.map((s, i) => (
                            <span key={i} className="mx-12 text-xs font-bold text-yellow-400 uppercase tracking-widest">
                                TOP SUPPORTER: <span className="text-white">{s.name}</span> <span className="text-emerald-400 ml-1">₹{s.amount}</span>
                            </span>
                        ))}
                        {supporters.map((s, i) => (
                            <span key={`dup-${i}`} className="mx-12 text-xs font-bold text-yellow-400 uppercase tracking-widest">
                                TOP SUPPORTER: <span className="text-white">{s.name}</span> <span className="text-emerald-400 ml-1">₹{s.amount}</span>
                            </span>
                        ))}
                    </div>
                </div>
            );
        };

        const RedirectOverlay = ({ appName }) => (
            <div className="fixed inset-0 z-[100] bg-white flex flex-col items-center justify-center fade-in">
                <div className="loader rounded-full border-4 border-slate-100 h-16 w-16 mb-6"></div>
                <h2 className="text-2xl font-bold text-slate-800 mb-2">Here you go...</h2>
                <p className="text-slate-500">Opening {appName}</p>
            </div>
        );

        const PaymentModal = ({ onClose }) => {
            const cardRef = useRef(null);
            const [copied, setCopied] = useState(false);
            const [downloading, setDownloading] = useState(false);
            
            const upiLink = `upi://pay?pa=${UPI_ID}&pn=${encodeURIComponent(PAYEE_NAME)}&cu=INR`;
            // Using a CORS-friendly QR API if possible, usually requires proxy for html2canvas
            // We use standard img tag, html2canvas useCORS:true might work if server allows.
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(upiLink)}`;

            useEffect(() => {
                // Auto Download Logic
                let timer = setTimeout(() => {
                    if (cardRef.current && window.html2canvas) {
                        setDownloading(true);
                        window.html2canvas(cardRef.current, {
                            useCORS: true,
                            backgroundColor: "#ffffff",
                            scale: 2 // Higher resolution
                        }).then(canvas => {
                            const link = document.createElement('a');
                            link.download = 'HappySolutions-PaymentCard.png';
                            link.href = canvas.toDataURL('image/png');
                            link.click();
                            setDownloading(false);
                        }).catch(err => {
                            console.error("Download failed", err);
                            setDownloading(false);
                        });
                    }
                }, 1000); // 1s delay to ensure render

                return () => clearTimeout(timer);
            }, []);

            const handleCopy = () => {
                const textArea = document.createElement("textarea");
                textArea.value = UPI_ID;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                } catch (err) {
                    console.error('Copy failed', err);
                }
                document.body.removeChild(textArea);
            };

            return (
                <div className="fixed inset-0 z-[80] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 fade-in" onClick={onClose}>
                    {/* The Card to be Captured */}
                    <div 
                        ref={cardRef}
                        className="bg-white w-72 rounded-3xl overflow-hidden shadow-2xl modal-enter relative flex flex-col" 
                        onClick={e => e.stopPropagation()}
                    >
                        {/* Close button (Excluded from capture technically if we target inner, but we capture whole card) 
                            Actually, we might want to hide close button in capture, but for simplicity we keep it or overlay it.
                        */}
                        <button onClick={onClose} className="absolute top-3 right-3 text-white/50 hover:text-white z-20">
                            <i className="fa-solid fa-xmark"></i>
                        </button>

                        {/* Card Header */}
                        <div className="bg-slate-900 pt-8 pb-6 px-6 text-center relative">
                            <div className="w-12 h-12 bg-yellow-400 rounded-full flex items-center justify-center mx-auto mb-3 shadow-lg border-2 border-slate-800">
                                <i className="fa-solid fa-heart text-slate-900 text-lg"></i>
                            </div>
                            <h3 className="text-white font-black text-lg uppercase tracking-wider leading-none">Support Us</h3>
                            <p className="text-slate-400 text-[10px] mt-1 font-medium">Scan to Pay via UPI</p>
                        </div>
                        
                        {/* Card Body */}
                        <div className="px-6 py-6 flex flex-col items-center bg-white">
                            <div className="p-2 border-2 border-dashed border-slate-200 rounded-xl bg-slate-50 mb-4">
                                <img src={qrUrl} alt="QR" className="w-32 h-32 mix-blend-multiply" crossOrigin="anonymous" />
                            </div>

                            <div 
                                onClick={handleCopy}
                                className={`w-full flex items-center justify-between p-3 rounded-xl border cursor-pointer transition-colors mb-4 ${copied ? 'bg-green-50 border-green-200' : 'bg-slate-50 border-slate-200'}`}
                            >
                                <div className="text-left overflow-hidden">
                                    <p className="text-[9px] font-bold text-slate-400 uppercase">UPI ID</p>
                                    <p className="text-xs font-mono font-bold text-slate-800 truncate">{UPI_ID}</p>
                                </div>
                                <i className={`fa-solid ${copied ? 'fa-check text-green-500' : 'fa-copy text-slate-400'} text-xs`}></i>
                            </div>

                            {/* Footer Signature */}
                            <div className="text-center pt-2 border-t border-slate-100 w-full">
                                <p className="text-[9px] font-bold text-slate-400 uppercase tracking-widest flex items-center justify-center gap-1">
                                    Made with <span className="text-red-500">❤️</span> By Happy Solutions
                                </p>
                            </div>
                        </div>

                        {/* Download Indicator Overlay (Only visible during processing) */}
                        {downloading && (
                            <div className="absolute inset-0 bg-white/80 flex items-center justify-center z-30">
                                <p className="text-xs font-bold text-slate-500 animate-pulse">Saving to Gallery...</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const CoffeeButton = ({ onClick }) => (
            <div className="fixed bottom-6 right-6 z-50 flex flex-col items-center cursor-pointer group" onClick={onClick}>
                <div className="mb-2 coffee-float">
                    <div className="bg-yellow-400 text-slate-900 text-[10px] font-black px-3 py-1.5 rounded-lg shadow-md whitespace-nowrap relative border border-yellow-500 tracking-wide">
                        BUY ME A COFFEE
                        <div className="absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-yellow-400 rotate-45 border-b border-r border-yellow-500"></div>
                    </div>
                </div>
                
                <div className="bg-slate-900 text-white p-3.5 rounded-full shadow-2xl border-2 border-yellow-400 hover:scale-110 hover:bg-slate-800 transition-all duration-300 relative overflow-hidden group-hover:rotate-12">
                     <div className="absolute inset-0 bg-white/10 rounded-full animate-ping opacity-20"></div>
                    <i className="fa-solid fa-mug-hot text-xl"></i>
                </div>
            </div>
        );

        const App = () => {
            const [apps, setApps] = useState([]);
            const [supporters, setSupporters] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [searchTerm, setSearchTerm] = useState("");
            const [redirecting, setRedirecting] = useState(null);
            const [showPayment, setShowPayment] = useState(false);

            useEffect(() => {
                const fetchData = async () => {
                    try {
                        const response = await fetch(SCRIPT_URL);
                        const data = await response.json();
                        if (data.apps) {
                            setApps(data.apps);
                            setSupporters(data.supporters || []);
                        } else if (Array.isArray(data)) {
                            setApps(data);
                        }
                    } catch (err) {
                        setError("Connection error. Please try again.");
                    } finally {
                        setLoading(false);
                    }
                };
                fetchData();
            }, []);

            const handleLaunch = (name, url) => {
                setRedirecting({ name, url });
                setTimeout(() => {
                    window.location.href = url;
                }, 2000);
            };

            const filteredApps = useMemo(() => {
                return apps.filter(app => app.name.toLowerCase().includes(searchTerm.toLowerCase()));
            }, [apps, searchTerm]);

            if (redirecting) return <RedirectOverlay appName={redirecting.name} />;

            return (
                <div className="h-full flex flex-col max-w-lg mx-auto bg-white border-x border-slate-200 relative overflow-hidden">
                    <Ticker supporters={supporters} />
                    
                    <div className="px-6 py-6 border-b border-slate-100 bg-white z-20">
                        <div className="relative group">
                            <i className="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500 transition-colors"></i>
                            <input 
                                type="text" 
                                placeholder="Search apps..." 
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                                className="w-full bg-slate-50 border border-slate-200 rounded-xl pl-12 pr-4 py-4 text-sm outline-none focus:ring-2 focus:ring-blue-500/10 focus:border-blue-500 transition-all"
                            />
                        </div>
                    </div>
                    
                    <main className="flex-1 overflow-y-auto ios-scroll px-6 py-8 bg-slate-50/50 pb-32">
                        {loading ? (
                            <div className="flex flex-col items-center justify-center h-64 text-slate-400">
                                <div className="loader rounded-full border-4 border-slate-200 h-12 w-12 mb-4"></div>
                                <p className="text-sm font-medium">Syncing Hub...</p>
                            </div>
                        ) : error ? (
                            <div className="text-center p-10 bg-white rounded-2xl border border-red-100 shadow-sm">
                                <i className="fa-solid fa-circle-exclamation text-red-400 text-3xl mb-4"></i>
                                <p className="text-slate-800 font-bold">{error}</p>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 gap-4">
                                {filteredApps.map((app, index) => (
                                    <button 
                                        key={index}
                                        onClick={() => handleLaunch(app.name, app.url)} 
                                        className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm active:bg-slate-50 hover:border-blue-500/50 transition-all flex items-center justify-center min-h-[110px] w-full group"
                                    >
                                        <span className="text-lg font-black text-slate-800 text-center uppercase tracking-tight group-hover:text-blue-600 transition-colors">
                                            {app.name}
                                        </span>
                                    </button>
                                ))}
                                {filteredApps.length === 0 && (
                                    <div className="text-center py-20 text-slate-400 italic text-sm">No results found</div>
                                )}
                            </div>
                        )}
                    </main>

                    <CoffeeButton onClick={() => setShowPayment(true)} />

                    {showPayment && <PaymentModal onClose={() => setShowPayment(false)} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


